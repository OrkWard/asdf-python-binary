#!/usr/bin/env bash

set -euo pipefail

source "$(dirname "$0")/utils.sh"

list_all() {
  local target archive releases release assets_json
  target=$(detect_target_triple)
  archive=$(archive_flavor)
  releases=$(release_tags_to_search | sed '/^$/d' | uniq)

  if [ -z "$releases" ]; then
    echoerr "No release tags to search."
    exit 1
  fi

  local versions=""
  while read -r release; do
    assets_json=$(release_assets_json "$release")
    versions+=$'\n'"$(extract_versions_for_target "$assets_json" "$target" "$archive")"
  done <<<"$releases"

  echo "$versions" | sed '/^$/d' | sort -V | uniq
}

list_all
